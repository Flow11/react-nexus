"use strict";

require("6to5/polyfill");
var Promise = require("bluebird");
module.exports = function (R) {
  var _ = require("lodash");
  var assert = require("assert");

  var defaultParams = {
    width: 1280,
    height: 720,
    scrollTop: 0,
    scrollLeft: 0 };

  var Window = {
    createPlugin: function (storeName, dispatcherName, eventEmitterName, params) {
      params = params || {};
      _.defaults(params, defaultParams);
      return R.App.createPlugin({
        displayName: "Window",
        installInClient: function (flux, window) {
          var _this = this;

          flux.getDispatcher(dispatcherName).addActionListener("/Window/scrollTo", function (params) {
            return _.copromise(regeneratorRuntime.mark(function callee$4$0() {
              return regeneratorRuntime.wrap(function callee$4$0$(context$5$0) {
                while (1) switch (context$5$0.prev = context$5$0.next) {case 0:

                    _.dev(function () {
                      return params.should.be.an.Object && params.top.should.be.ok && params.top.should.be.a.Number && params.left.should.be.ok && params.left.should.be.a.Number;
                    });
                    window.scrollTo(params.top, params.left);
                    context$5$0.next = 4;
                    return _.defer;

                  case 4:
                  case "end": return context$5$0.stop();
                }
              }, callee$4$0, this);
            }), _this);
          });
          window.addEventListener("scroll", function () {
            flux.getStore(storeName).set("/Window/scrollTop", window.scrollTop);
            flux.getStore(storeName).set("/Window/scrollLeft", window.scrollLeft);
            flux.getEventEmitter(eventEmitterName).emit("/Window/scroll", {
              scrollTop: window.scrollTop,
              scrollLeft: window.scrollLeft });
          });
          window.addEventListener("resize", function () {
            flux.getStore(storeName).set("/Window/height", window.innerHeight);
            flux.getStore(storeName).set("/Window/width", window.innerWidth);
            flux.getEventEmitter(eventEmitterName).emit("/Window/resize", {
              height: window.innerHeight,
              width: window.innerWidth });
          });
          flux.getStore(storeName).set("/Window/height", window.innerHeight);
          flux.getStore(storeName).set("/Window/width", window.innerWidth);
          flux.getStore(storeName).set("/Window/scrollTop", window.scrollTop);
          flux.getStore(storeName).set("/Window/scrollLeft", window.scrollLeft);
        },
        installInServer: function (flux, req) {
          flux.getStore(storeName).set("/Window/height", params.height);
          flux.getStore(storeName).set("/Window/width", params.width);
          flux.getStore(storeName).set("/Window/scrollTop", params.scrollTop);
          flux.getStore(storeName).set("/Window/scrollLeft", params.scrollLeft);
        } });
    } };

  return Window;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImQ6L3dvcmtzcGFjZV9yZWZhY3Rvci9yZWFjdC1yYWlscy9zcmMvUi5XaW5kb3cuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7QUFDekIsSUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQ3BDLE1BQU0sQ0FBQyxPQUFPLEdBQUcsVUFBUyxDQUFDLEVBQUU7QUFDekIsTUFBTSxDQUFDLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzVCLE1BQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQzs7QUFFakMsTUFBTSxhQUFhLEdBQUc7QUFDbEIsU0FBSyxFQUFFLElBQUk7QUFDWCxVQUFNLEVBQUUsR0FBRztBQUNYLGFBQVMsRUFBRSxDQUFDO0FBQ1osY0FBVSxFQUFFLENBQUMsRUFDaEIsQ0FBQzs7QUFFRixNQUFNLE1BQU0sR0FBRztBQUNYLGdCQUFZLEVBQUEsVUFBQyxTQUFTLEVBQUUsY0FBYyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sRUFBRTtBQUM5RCxZQUFNLEdBQUcsTUFBTSxJQUFJLEVBQUUsQ0FBQztBQUN0QixPQUFDLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxhQUFhLENBQUMsQ0FBQztBQUNsQyxhQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDO0FBQ3RCLG1CQUFXLEVBQUUsUUFBUTtBQUNyQix1QkFBZSxFQUFBLFVBQUMsSUFBSSxFQUFFLE1BQU0sRUFBRTs7O0FBQzFCLGNBQUksQ0FBQyxhQUFhLENBQUMsY0FBYyxDQUFDLENBQUMsaUJBQWlCLENBQUMsa0JBQWtCLEVBQUUsVUFBQyxNQUFNLEVBQUs7QUFDakYsbUJBQU8sQ0FBQyxDQUFDLFNBQVMseUJBQUM7Ozs7QUFDZixxQkFBQyxDQUFDLEdBQUcsQ0FBQzs2QkFDRixNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsTUFBTSxJQUMx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QUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsRUFBRSxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7U0FDekUsRUFDSixDQUFDLENBQUM7S0FDTixFQUNKLENBQUM7O0FBRUYsU0FBTyxNQUFNLENBQUM7Q0FDakIsQ0FBQyIsImZpbGUiOiJSLldpbmRvdy5qcyIsInNvdXJjZXNDb250ZW50IjpbInJlcXVpcmUoJzZ0bzUvcG9seWZpbGwnKTtcbmNvbnN0IFByb21pc2UgPSByZXF1aXJlKCdibHVlYmlyZCcpO1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihSKSB7XHJcbiAgICBjb25zdCBfID0gcmVxdWlyZShcImxvZGFzaFwiKTtcclxuICAgIGNvbnN0IGFzc2VydCA9IHJlcXVpcmUoXCJhc3NlcnRcIik7XHJcblxyXG4gICAgY29uc3QgZGVmYXVsdFBhcmFtcyA9IHtcclxuICAgICAgICB3aWR0aDogMTI4MCxcclxuICAgICAgICBoZWlnaHQ6IDcyMCxcclxuICAgICAgICBzY3JvbGxUb3A6IDAsXHJcbiAgICAgICAgc2Nyb2xsTGVmdDogMCxcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgV2luZG93ID0ge1xyXG4gICAgICAgIGNyZWF0ZVBsdWdpbihzdG9yZU5hbWUsIGRpc3BhdGNoZXJOYW1lLCBldmVudEVtaXR0ZXJOYW1lLCBwYXJhbXMpIHtcclxuICAgICAgICAgICAgcGFyYW1zID0gcGFyYW1zIHx8IHt9O1xyXG4gICAgICAgICAgICBfLmRlZmF1bHRzKHBhcmFtcywgZGVmYXVsdFBhcmFtcyk7XHJcbiAgICAgICAgICAgIHJldHVybiBSLkFwcC5jcmVhdGVQbHVnaW4oe1xyXG4gICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IFwiV2luZG93XCIsXHJcbiAgICAgICAgICAgICAgICBpbnN0YWxsSW5DbGllbnQoZmx1eCwgd2luZG93KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmx1eC5nZXREaXNwYXRjaGVyKGRpc3BhdGNoZXJOYW1lKS5hZGRBY3Rpb25MaXN0ZW5lcihcIi9XaW5kb3cvc2Nyb2xsVG9cIiwgKHBhcmFtcykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXy5jb3Byb21pc2UoZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZGV2KCgpID0+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zLnNob3VsZC5iZS5hbi5PYmplY3QgJiZcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXMudG9wLnNob3VsZC5iZS5vayAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtcy50b3Auc2hvdWxkLmJlLmEuTnVtYmVyICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zLmxlZnQuc2hvdWxkLmJlLm9rICYmIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtcy5sZWZ0LnNob3VsZC5iZS5hLk51bWJlclxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8ocGFyYW1zLnRvcCwgcGFyYW1zLmxlZnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeWllbGQgXy5kZWZlcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJzY3JvbGxcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmbHV4LmdldFN0b3JlKHN0b3JlTmFtZSkuc2V0KFwiL1dpbmRvdy9zY3JvbGxUb3BcIiwgd2luZG93LnNjcm9sbFRvcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZsdXguZ2V0U3RvcmUoc3RvcmVOYW1lKS5zZXQoXCIvV2luZG93L3Njcm9sbExlZnRcIiwgd2luZG93LnNjcm9sbExlZnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmbHV4LmdldEV2ZW50RW1pdHRlcihldmVudEVtaXR0ZXJOYW1lKS5lbWl0KFwiL1dpbmRvdy9zY3JvbGxcIiwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsVG9wOiB3aW5kb3cuc2Nyb2xsVG9wLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsTGVmdDogd2luZG93LnNjcm9sbExlZnQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicmVzaXplXCIsICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmx1eC5nZXRTdG9yZShzdG9yZU5hbWUpLnNldChcIi9XaW5kb3cvaGVpZ2h0XCIsIHdpbmRvdy5pbm5lckhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZsdXguZ2V0U3RvcmUoc3RvcmVOYW1lKS5zZXQoXCIvV2luZG93L3dpZHRoXCIsIHdpbmRvdy5pbm5lcldpZHRoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmx1eC5nZXRFdmVudEVtaXR0ZXIoZXZlbnRFbWl0dGVyTmFtZSkuZW1pdChcIi9XaW5kb3cvcmVzaXplXCIsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogd2luZG93LmlubmVySGVpZ2h0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHdpbmRvdy5pbm5lcldpZHRoLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBmbHV4LmdldFN0b3JlKHN0b3JlTmFtZSkuc2V0KFwiL1dpbmRvdy9oZWlnaHRcIiwgd2luZG93LmlubmVySGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgICAgICBmbHV4LmdldFN0b3JlKHN0b3JlTmFtZSkuc2V0KFwiL1dpbmRvdy93aWR0aFwiLCB3aW5kb3cuaW5uZXJXaWR0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZmx1eC5nZXRTdG9yZShzdG9yZU5hbWUpLnNldChcIi9XaW5kb3cvc2Nyb2xsVG9wXCIsIHdpbmRvdy5zY3JvbGxUb3ApO1xyXG4gICAgICAgICAgICAgICAgICAgIGZsdXguZ2V0U3RvcmUoc3RvcmVOYW1lKS5zZXQoXCIvV2luZG93L3Njcm9sbExlZnRcIiwgd2luZG93LnNjcm9sbExlZnQpO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGluc3RhbGxJblNlcnZlcihmbHV4LCByZXEpIHtcclxuICAgICAgICAgICAgICAgICAgICBmbHV4LmdldFN0b3JlKHN0b3JlTmFtZSkuc2V0KFwiL1dpbmRvdy9oZWlnaHRcIiwgcGFyYW1zLmhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZmx1eC5nZXRTdG9yZShzdG9yZU5hbWUpLnNldChcIi9XaW5kb3cvd2lkdGhcIiwgcGFyYW1zLndpZHRoKTtcclxuICAgICAgICAgICAgICAgICAgICBmbHV4LmdldFN0b3JlKHN0b3JlTmFtZSkuc2V0KFwiL1dpbmRvdy9zY3JvbGxUb3BcIiwgcGFyYW1zLnNjcm9sbFRvcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZmx1eC5nZXRTdG9yZShzdG9yZU5hbWUpLnNldChcIi9XaW5kb3cvc2Nyb2xsTGVmdFwiLCBwYXJhbXMuc2Nyb2xsTGVmdCk7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gV2luZG93O1xyXG59O1xyXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=