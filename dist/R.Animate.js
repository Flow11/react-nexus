"use strict";

var _classProps = function (child, staticProps, instanceProps) {
  if (staticProps) Object.defineProperties(child, staticProps);

  if (instanceProps) Object.defineProperties(child.prototype, instanceProps);
};

require("6to5/polyfill");
var Promise = require("bluebird");
module.exports = function (R) {
  var _ = R._;
  var should = R.should;
  var d3 = require("d3");
  var raf = require("raf");

  var InterpolationTicker = (function () {
    var InterpolationTicker = function InterpolationTicker() {
      var _this = this;

      _.dev(function () {
        return params.should.be.an.Object;
      });
      _.defaults(params, {
        easing: "cubic-in-out",
        onTick: _.noop,
        onComplete: _.noop,
        onAbort: _.noop });

      _.dev(function () {
        return params.from.should.be.an.Object && params.to.should.be.an.Object && params.duration.should.be.a.Number && (_.isPlainObject(params.easing) || _.isString(params.easing)).should.be.ok && params.onTick.should.be.a.Function && params.onComplete.should.be.a.Function && params.onAbort.should.be.a.Function;
      });

      this._from = params.from;
      this._to = params.to;

      Object.keys(this._from).forEach(function (attr) {
        return _.has(_this._to, attr) ? _this._to[attr] = _this._from[attr] : void 0;
      });
      Object.keys(this._to).forEach(function (attr) {
        return _.has(_this._from, attr) ? _this._from[attr] = _this._to[attr] : void 0;
      });

      if (_.isPlainObject(params.easing)) {
        _.dev(function () {
          return params.easing.type.should.be.a.String && params.easing.params.should.be.an.Object;
        });
        this._easing = R.Animate.createEasing(params.easing.type, params.easing.params);
      } else {
        this._easing = R.Animate.createEasing(params.easing);
      }
      this._duration = params.duration;
      this._onTick = params.onTick;
      this._onComplete = params.onComplete;
      this._onAbort = params.onAbort;
      this._interpolators = _.mapValues(this._from, function (fromVal, attr) {
        return R.Animate.createInterpolator(fromVal, _this._to[attr]);
      });
      this._tick = R.scope(this._tick, this);
    };

    _classProps(InterpolationTicker, null, {
      start: {
        writable: true,
        value: function () {
          var _this2 = this;

          _.dev(function () {
            return (_this2._begin === null).should.be.ok;
          });
          this._begin = Date.now();
          this._end = this._begin + this._duration;
          this._requestAnimationFrameHandle = raf(this._tick);
        }
      },
      _tick: {
        writable: true,
        value: function () {
          var _this3 = this;

          var now = Date.now();
          if (now > this._end) {
            this._onTick(this._to, t);
            this._onComplete();
          } else {
            (function () {
              var t = (now - _this3._begin) / (_this3._end - _this3._begin);
              _this3._onTick(_.mapValues(_this3._interpolators, function (interpolator) {
                return interpolator(_this3._easing(t));
              }, t));
              _this3._requestAnimationFrameHandle = raf(_this3._tick);
            })();
          }
        }
      },
      abort: {
        writable: true,
        value: function () {
          if (this._requestAnimationFrameHandle) {
            raf.cancel(this._requestAnimationFrameHandle);
            this._requestAnimationFrameHandle = null;
          }
        }
      }
    });

    return InterpolationTicker;
  })();

  _.extend(InterpolationTicker.prototype, /** @lends R.Animate.InterpolationTicker.prototype */{
    _from: null,
    _to: null,
    _easing: null,
    _duration: null,
    _onTick: null,
    _onComplete: null,
    _onAbort: null,
    _requestAnimationFrameHandle: null,
    _begin: null,
    _end: null,
    _interpolators: null });

  var Animate = {
    Mixin: {
      _AnimateMixinHasAnimateMixin: true,
      _AnimateMixinInterpolationTickers: null,

      componentWillMount: function () {
        this._AnimateMixinInterpolationTickers = {};
      },

      componentWillUnmount: function () {
        var _this4 = this;

        Object.keys(this._AnimateMixinInterpolationTickers).forEach(function (name) {
          return _this4._AnimateMixinInterpolationTickers[name].abort();
        });
        this._AnimateMixinInterpolationTickers = null;
      },

      isAnimating: function (name) {
        return this._AnimateMixinInterpolationTickers[name];
      },

      _AnimateMixinGetStateKey: function (name) {
        return "_AnimateMixinStyle-" + name;
      },

      getAnimatedStyle: function (name) {
        if (this.isAnimating(name)) {
          return this.state[this._AnimateMixinGetStateKey(name)];
        } else {
          _.dev(function () {
            return console.warn("R.Animate.Mixin.getAnimatedStyle(...): no such animation.");
          });
          return {};
        }
      },

      abortAnimation: function (name) {
        var _this5 = this;

        _.dev(function () {
          return _this5.isAnimating(name).should.be.ok;
        });
        if (this.isAnimating(name)) {
          this._AnimateMixinInterpolationTickers[name].abort();
        }
      },

      animate: function (name, params) {
        var _this6 = this;

        if (this.isAnimating(name)) {
          this.abortAnimation(name);
        }

        params = _.extend({}, params, {
          onTick: _.noop,
          onComplete: _.noop,
          onAbort: _.noop });

        var original = {
          onTick: params.onTick,
          onComplete: params.onComplete,
          onAbort: params.onAbort };

        params.onTick = function (animatedStyle, t) {
          original.onTick(animatedStyle, t);
          _this6.setStateIfMounted((function (_ref) {
            _ref[_this6._AnimateMixinGetStateKey(name)] = animatedStyle;
            return _ref;
          })({}));
        };

        params.onComplete = function (animatedStyle, t) {
          original.onComplete(animatedStyle, t);
          delete _this6._AnimateMixinInterpolationTickers[name];
          _this6.setStateIfMounted((function (_ref2) {
            _ref2[_this6._AnimateMixinGetStateKey(name)] = void 0;
            return _ref2;
          })({}));
        };

        params.onAbort = function () {
          original.onAbort();
          delete _this6._AnimateMixinInterpolationTickers[name];
          _this6.setStateIfMounted((function (_ref3) {
            _ref3[_this6._AnimateMixinGetStateKey(name)] = void 0;
            return _ref3;
          })({}));
        };

        var interpolationTicker = new R.Animate.InterpolationTicker(params);
        this._AnimateMixinInterpolationTickers[name] = interpolationTicker;
        interpolationTicker.start();
      } },

    createInterpolator: function (from, to) {
      return d3.interpolate(from, to);
    },

    createEasing: function (type, params) {
      if (params) {
        var args = _.clone(params);
        args.unshift(type);
        return d3.ease.apply(d3, args);
      } else {
        return d3.ease(type);
      }
    },

    InterpolationTicker: InterpolationTicker,

    shouldEnableHA: function () {
      if (_.isClient()) {
        var userAgent = navigator.userAgent;
        var isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
        var isGingerbread = /Android 2\.3\.[3-7]/i.test(userAgent);
        return userAgent && isMobile && !isGingerbread;
      } else {
        return true;
      }
    } };

  return Animate;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImY6L1VzZXJzL0VsaWUvZ2l0L3JlYWN0L3JlYWN0LXJhaWxzL3NyYy9SLkFuaW1hdGUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQSxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7QUFDekIsSUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQ3BDLE1BQU0sQ0FBQyxPQUFPLEdBQUcsVUFBUyxDQUFDLEVBQUU7QUFDM0IsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNkLE1BQU0sTUFBTSxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUM7QUFDeEIsTUFBTSxFQUFFLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ3pCLE1BQU0sR0FBRyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQzs7TUFFckIsbUJBQW1CO1FBQW5CLG1CQUFtQixHQUNaLFNBRFAsbUJBQW1CLEdBQ1Q7OztBQUNaLE9BQUMsQ0FBQyxHQUFHLENBQUM7ZUFBTSxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsTUFBTTtPQUFBLENBQUMsQ0FBQztBQUN4QyxPQUFDLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRTtBQUNqQixjQUFNLEVBQUUsY0FBYztBQUN0QixjQUFNLEVBQUUsQ0FBQyxDQUFDLElBQUk7QUFDZCxrQkFBVSxFQUFFLENBQUMsQ0FBQyxJQUFJO0FBQ2xCLGVBQU8sRUFBRSxDQUFDLENBQUMsSUFBSSxFQUNoQixDQUFDLENBQUM7O0FBRUgsT0FBQyxDQUFDLEdBQUcsQ0FBQztlQUNKLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsTUFBTSxJQUMvQixNQUFNLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLE1BQU0sSUFDN0IsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFD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QixFQUFBLFVBQUMsSUFBSSxFQUFFLEVBQUUsRUFBRTtBQUMzQixhQUFPLEVBQUUsQ0FBQyxXQUFXLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0tBQ2pDOztBQUVELGdCQUFZLEVBQUEsVUFBQyxJQUFJLEVBQUUsTUFBTSxFQUFFO0FBQ3pCLFVBQUcsTUFBTSxFQUFFO0FBQ1QsWUFBSSxJQUFJLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUMzQixZQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ25CLGVBQU8sRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxDQUFDO09BQ2hDLE1BQ0k7QUFDSCxlQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7T0FDdEI7S0FDRjs7QUFFRCx1QkFBbUIsRUFBbkIsbUJBQW1COztBQUVuQixrQkFBYyxFQUFBLFlBQUc7QUFDZixVQUFHLENBQUMsQ0FBQyxRQUFRLEVBQUUsRUFBRTtBQUNmLFlBQUksU0FBUyxHQUFHLFNBQVMsQ0FBQyxTQUFTLENBQUM7QUFDcEMsWUFBSSxRQUFRLEdBQUcsZ0VBQWdFLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQ2hHLFlBQUksYUFBYSxHQUFHLHNCQUFzQixDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUMzRCxlQUFPLFNBQVMsSUFBSSxRQUFRLElBQUksQ0FBQyxhQUFhLENBQUM7T0FDaEQsTUFDSTtBQUNILGVBQU8sSUFBSSxDQUFDO09BQ2I7S0FDRixFQUNGLENBQUM7O0FBRUYsU0FBTyxPQUFPLENBQUM7Q0FDaEIsQ0FBQyIsImZpbGUiOiJSLkFuaW1hdGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJyZXF1aXJlKCc2dG81L3BvbHlmaWxsJyk7XG5jb25zdCBQcm9taXNlID0gcmVxdWlyZSgnYmx1ZWJpcmQnKTtcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oUikge1xyXG4gIGNvbnN0IF8gPSBSLl87XHJcbiAgY29uc3Qgc2hvdWxkID0gUi5zaG91bGQ7XHJcbiAgY29uc3QgZDMgPSByZXF1aXJlKCdkMycpO1xyXG4gIGNvbnN0IHJhZiA9IHJlcXVpcmUoJ3JhZicpO1xyXG5cclxuICBjbGFzcyBJbnRlcnBvbGF0aW9uVGlja2VyIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICBfLmRldigoKSA9PiBwYXJhbXMuc2hvdWxkLmJlLmFuLk9iamVjdCk7XHJcbiAgICAgIF8uZGVmYXVsdHMocGFyYW1zLCB7XHJcbiAgICAgICAgZWFzaW5nOiAnY3ViaWMtaW4tb3V0JyxcclxuICAgICAgICBvblRpY2s6IF8ubm9vcCxcclxuICAgICAgICBvbkNvbXBsZXRlOiBfLm5vb3AsXHJcbiAgICAgICAgb25BYm9ydDogXy5ub29wLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIF8uZGV2KCgpID0+XHJcbiAgICAgICAgcGFyYW1zLmZyb20uc2hvdWxkLmJlLmFuLk9iamVjdCAmJlxyXG4gICAgICAgIHBhcmFtcy50by5zaG91bGQuYmUuYW4uT2JqZWN0ICYmXHJcbiAgICAgICAgcGFyYW1zLmR1cmF0aW9uLnNob3VsZC5iZS5hLk51bWJlciAmJlxyXG4gICAgICAgIChfLmlzUGxhaW5PYmplY3QocGFyYW1zLmVhc2luZykgfHwgXy5pc1N0cmluZyhwYXJhbXMuZWFzaW5nKSkuc2hvdWxkLmJlLm9rICYmXHJcbiAgICAgICAgcGFyYW1zLm9uVGljay5zaG91bGQuYmUuYS5GdW5jdGlvbiAmJlxyXG4gICAgICAgIHBhcmFtcy5vbkNvbXBsZXRlLnNob3VsZC5iZS5hLkZ1bmN0aW9uICYmXHJcbiAgICAgICAgcGFyYW1zLm9uQWJvcnQuc2hvdWxkLmJlLmEuRnVuY3Rpb25cclxuICAgICAgKTtcclxuXHJcbiAgICAgIHRoaXMuX2Zyb20gPSBwYXJhbXMuZnJvbTtcclxuICAgICAgdGhpcy5fdG8gPSBwYXJhbXMudG87XHJcblxyXG4gICAgICBPYmplY3Qua2V5cyh0aGlzLl9mcm9tKVxyXG4gICAgICAuZm9yRWFjaCgoYXR0cikgPT4gXy5oYXModGhpcy5fdG8sIGF0dHIpID8gdGhpcy5fdG9bYXR0cl0gPSB0aGlzLl9mcm9tW2F0dHJdIDogdm9pZCAwKTtcclxuICAgICAgT2JqZWN0LmtleXModGhpcy5fdG8pXHJcbiAgICAgIC5mb3JFYWNoKChhdHRyKSA9PiBfLmhhcyh0aGlzLl9mcm9tLCBhdHRyKSA/IHRoaXMuX2Zyb21bYXR0cl0gPSB0aGlzLl90b1thdHRyXSA6IHZvaWQgMCk7XHJcblxyXG4gICAgICBpZihfLmlzUGxhaW5PYmplY3QocGFyYW1zLmVhc2luZykpIHtcclxuICAgICAgICBfLmRldigoKSA9PiBwYXJhbXMuZWFzaW5nLnR5cGUuc2hvdWxkLmJlLmEuU3RyaW5nICYmXHJcbiAgICAgICAgICBwYXJhbXMuZWFzaW5nLnBhcmFtcy5zaG91bGQuYmUuYW4uT2JqZWN0XHJcbiAgICAgICAgKTtcclxuICAgICAgICB0aGlzLl9lYXNpbmcgPSBSLkFuaW1hdGUuY3JlYXRlRWFzaW5nKHBhcmFtcy5lYXNpbmcudHlwZSwgcGFyYW1zLmVhc2luZy5wYXJhbXMpO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHRoaXMuX2Vhc2luZyA9IFIuQW5pbWF0ZS5jcmVhdGVFYXNpbmcocGFyYW1zLmVhc2luZyk7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5fZHVyYXRpb24gPSBwYXJhbXMuZHVyYXRpb247XHJcbiAgICAgIHRoaXMuX29uVGljayA9IHBhcmFtcy5vblRpY2s7XHJcbiAgICAgIHRoaXMuX29uQ29tcGxldGUgPSBwYXJhbXMub25Db21wbGV0ZTtcclxuICAgICAgdGhpcy5fb25BYm9ydCA9IHBhcmFtcy5vbkFib3J0O1xyXG4gICAgICB0aGlzLl9pbnRlcnBvbGF0b3JzID0gXy5tYXBWYWx1ZXModGhpcy5fZnJvbSwgKGZyb21WYWwsIGF0dHIpID0+IFIuQW5pbWF0ZS5jcmVhdGVJbnRlcnBvbGF0b3IoZnJvbVZhbCwgdGhpcy5fdG9bYXR0cl0pKTtcclxuICAgICAgdGhpcy5fdGljayA9IFIuc2NvcGUodGhpcy5fdGljaywgdGhpcyk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhcnQoKSB7XHJcbiAgICAgIF8uZGV2KCgpID0+ICh0aGlzLl9iZWdpbiA9PT0gbnVsbCkuc2hvdWxkLmJlLm9rKTtcclxuICAgICAgdGhpcy5fYmVnaW4gPSBEYXRlLm5vdygpO1xyXG4gICAgICB0aGlzLl9lbmQgPSB0aGlzLl9iZWdpbiArIHRoaXMuX2R1cmF0aW9uO1xyXG4gICAgICB0aGlzLl9yZXF1ZXN0QW5pbWF0aW9uRnJhbWVIYW5kbGUgPSByYWYodGhpcy5fdGljayk7XHJcbiAgICB9XHJcblxyXG4gICAgX3RpY2soKSB7XHJcbiAgICAgIGxldCBub3cgPSBEYXRlLm5vdygpO1xyXG4gICAgICBpZihub3cgPiB0aGlzLl9lbmQpIHtcclxuICAgICAgICB0aGlzLl9vblRpY2sodGhpcy5fdG8sIHQpO1xyXG4gICAgICAgIHRoaXMuX29uQ29tcGxldGUoKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBsZXQgdCA9IChub3cgLSB0aGlzLl9iZWdpbikvKHRoaXMuX2VuZCAtIHRoaXMuX2JlZ2luKTtcclxuICAgICAgICB0aGlzLl9vblRpY2soXy5tYXBWYWx1ZXModGhpcy5faW50ZXJwb2xhdG9ycywgKGludGVycG9sYXRvcikgPT4gaW50ZXJwb2xhdG9yKHRoaXMuX2Vhc2luZyh0KSksIHQpKTtcclxuICAgICAgICB0aGlzLl9yZXF1ZXN0QW5pbWF0aW9uRnJhbWVIYW5kbGUgPSByYWYodGhpcy5fdGljayk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBhYm9ydCgpIHtcclxuICAgICAgaWYodGhpcy5fcmVxdWVzdEFuaW1hdGlvbkZyYW1lSGFuZGxlKSB7XHJcbiAgICAgICAgcmFmLmNhbmNlbCh0aGlzLl9yZXF1ZXN0QW5pbWF0aW9uRnJhbWVIYW5kbGUpO1xyXG4gICAgICAgIHRoaXMuX3JlcXVlc3RBbmltYXRpb25GcmFtZUhhbmRsZSA9IG51bGw7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIF8uZXh0ZW5kKEludGVycG9sYXRpb25UaWNrZXIucHJvdG90eXBlLCAvKiogQGxlbmRzIFIuQW5pbWF0ZS5JbnRlcnBvbGF0aW9uVGlja2VyLnByb3RvdHlwZSAqLyB7XHJcbiAgICBfZnJvbTogbnVsbCxcclxuICAgIF90bzogbnVsbCxcclxuICAgIF9lYXNpbmc6IG51bGwsXHJcbiAgICBfZHVyYXRpb246IG51bGwsXHJcbiAgICBfb25UaWNrOiBudWxsLFxyXG4gICAgX29uQ29tcGxldGU6IG51bGwsXHJcbiAgICBfb25BYm9ydDogbnVsbCxcclxuICAgIF9yZXF1ZXN0QW5pbWF0aW9uRnJhbWVIYW5kbGU6IG51bGwsXHJcbiAgICBfYmVnaW46IG51bGwsXHJcbiAgICBfZW5kOiBudWxsLFxyXG4gICAgX2ludGVycG9sYXRvcnM6IG51bGwsXHJcbiAgfSk7XHJcblxyXG4gIGNvbnN0IEFuaW1hdGUgPSB7XHJcbiAgICBNaXhpbjoge1xyXG4gICAgICBfQW5pbWF0ZU1peGluSGFzQW5pbWF0ZU1peGluOiB0cnVlLFxyXG4gICAgICBfQW5pbWF0ZU1peGluSW50ZXJwb2xhdGlvblRpY2tlcnM6IG51bGwsXHJcblxyXG4gICAgICBjb21wb25lbnRXaWxsTW91bnQoKSB7XHJcbiAgICAgICAgdGhpcy5fQW5pbWF0ZU1peGluSW50ZXJwb2xhdGlvblRpY2tlcnMgPSB7fTtcclxuICAgICAgfSxcclxuXHJcbiAgICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xyXG4gICAgICAgIE9iamVjdC5rZXlzKHRoaXMuX0FuaW1hdGVNaXhpbkludGVycG9sYXRpb25UaWNrZXJzKVxyXG4gICAgICAgIC5mb3JFYWNoKChuYW1lKSA9PiB0aGlzLl9BbmltYXRlTWl4aW5JbnRlcnBvbGF0aW9uVGlja2Vyc1tuYW1lXS5hYm9ydCgpKTtcclxuICAgICAgICB0aGlzLl9BbmltYXRlTWl4aW5JbnRlcnBvbGF0aW9uVGlja2VycyA9IG51bGw7XHJcbiAgICAgIH0sXHJcblxyXG4gICAgICBpc0FuaW1hdGluZyhuYW1lKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX0FuaW1hdGVNaXhpbkludGVycG9sYXRpb25UaWNrZXJzW25hbWVdO1xyXG4gICAgICB9LFxyXG5cclxuICAgICAgX0FuaW1hdGVNaXhpbkdldFN0YXRlS2V5KG5hbWUpIHtcclxuICAgICAgICByZXR1cm4gJ19BbmltYXRlTWl4aW5TdHlsZS0nICsgbmFtZTtcclxuICAgICAgfSxcclxuXHJcbiAgICAgIGdldEFuaW1hdGVkU3R5bGUobmFtZSkge1xyXG4gICAgICAgIGlmKHRoaXMuaXNBbmltYXRpbmcobmFtZSkpIHtcclxuICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlW3RoaXMuX0FuaW1hdGVNaXhpbkdldFN0YXRlS2V5KG5hbWUpXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBfLmRldigoKSA9PiBjb25zb2xlLndhcm4oJ1IuQW5pbWF0ZS5NaXhpbi5nZXRBbmltYXRlZFN0eWxlKC4uLik6IG5vIHN1Y2ggYW5pbWF0aW9uLicpKTtcclxuICAgICAgICAgIHJldHVybiB7fTtcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcblxyXG4gICAgICBhYm9ydEFuaW1hdGlvbihuYW1lKSB7XHJcbiAgICAgICAgXy5kZXYoKCkgPT4gdGhpcy5pc0FuaW1hdGluZyhuYW1lKS5zaG91bGQuYmUub2spO1xyXG4gICAgICAgIGlmKHRoaXMuaXNBbmltYXRpbmcobmFtZSkpIHtcclxuICAgICAgICAgIHRoaXMuX0FuaW1hdGVNaXhpbkludGVycG9sYXRpb25UaWNrZXJzW25hbWVdLmFib3J0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG5cclxuICAgICAgYW5pbWF0ZShuYW1lLCBwYXJhbXMpIHtcclxuICAgICAgICBpZih0aGlzLmlzQW5pbWF0aW5nKG5hbWUpKSB7XHJcbiAgICAgICAgICB0aGlzLmFib3J0QW5pbWF0aW9uKG5hbWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcGFyYW1zID0gXy5leHRlbmQoe30sIHBhcmFtcywge1xyXG4gICAgICAgICAgb25UaWNrOiBfLm5vb3AsXHJcbiAgICAgICAgICBvbkNvbXBsZXRlOiBfLm5vb3AsXHJcbiAgICAgICAgICBvbkFib3J0OiBfLm5vb3AsXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGxldCBvcmlnaW5hbCA9IHtcclxuICAgICAgICAgIG9uVGljazogcGFyYW1zLm9uVGljayxcclxuICAgICAgICAgIG9uQ29tcGxldGU6IHBhcmFtcy5vbkNvbXBsZXRlLFxyXG4gICAgICAgICAgb25BYm9ydDogcGFyYW1zLm9uQWJvcnQsXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcGFyYW1zLm9uVGljayA9IChhbmltYXRlZFN0eWxlLCB0KSA9PiB7XHJcbiAgICAgICAgICBvcmlnaW5hbC5vblRpY2soYW5pbWF0ZWRTdHlsZSwgdCk7XHJcbiAgICAgICAgICB0aGlzLnNldFN0YXRlSWZNb3VudGVkKHsgW3RoaXMuX0FuaW1hdGVNaXhpbkdldFN0YXRlS2V5KG5hbWUpXTogYW5pbWF0ZWRTdHlsZSB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBwYXJhbXMub25Db21wbGV0ZSA9IChhbmltYXRlZFN0eWxlLCB0KSA9PiB7XHJcbiAgICAgICAgICBvcmlnaW5hbC5vbkNvbXBsZXRlKGFuaW1hdGVkU3R5bGUsIHQpO1xyXG4gICAgICAgICAgZGVsZXRlIHRoaXMuX0FuaW1hdGVNaXhpbkludGVycG9sYXRpb25UaWNrZXJzW25hbWVdO1xyXG4gICAgICAgICAgdGhpcy5zZXRTdGF0ZUlmTW91bnRlZCh7IFt0aGlzLl9BbmltYXRlTWl4aW5HZXRTdGF0ZUtleShuYW1lKV06IHZvaWQgMCB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBwYXJhbXMub25BYm9ydCA9ICgpID0+IHtcclxuICAgICAgICAgIG9yaWdpbmFsLm9uQWJvcnQoKTtcclxuICAgICAgICAgIGRlbGV0ZSB0aGlzLl9BbmltYXRlTWl4aW5JbnRlcnBvbGF0aW9uVGlja2Vyc1tuYW1lXTtcclxuICAgICAgICAgIHRoaXMuc2V0U3RhdGVJZk1vdW50ZWQoeyBbdGhpcy5fQW5pbWF0ZU1peGluR2V0U3RhdGVLZXkobmFtZSldOiB2b2lkIDAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgbGV0IGludGVycG9sYXRpb25UaWNrZXIgPSBuZXcgUi5BbmltYXRlLkludGVycG9sYXRpb25UaWNrZXIocGFyYW1zKTtcclxuICAgICAgICB0aGlzLl9BbmltYXRlTWl4aW5JbnRlcnBvbGF0aW9uVGlja2Vyc1tuYW1lXSA9IGludGVycG9sYXRpb25UaWNrZXI7XHJcbiAgICAgICAgaW50ZXJwb2xhdGlvblRpY2tlci5zdGFydCgpO1xyXG4gICAgICB9LFxyXG4gICAgfSxcclxuXHJcbiAgICBjcmVhdGVJbnRlcnBvbGF0b3IoZnJvbSwgdG8pIHtcclxuICAgICAgcmV0dXJuIGQzLmludGVycG9sYXRlKGZyb20sIHRvKTtcclxuICAgIH0sXHJcblxyXG4gICAgY3JlYXRlRWFzaW5nKHR5cGUsIHBhcmFtcykge1xyXG4gICAgICBpZihwYXJhbXMpIHtcclxuICAgICAgICBsZXQgYXJncyA9IF8uY2xvbmUocGFyYW1zKTtcclxuICAgICAgICBhcmdzLnVuc2hpZnQodHlwZSk7XHJcbiAgICAgICAgcmV0dXJuIGQzLmVhc2UuYXBwbHkoZDMsIGFyZ3MpO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBkMy5lYXNlKHR5cGUpO1xyXG4gICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIEludGVycG9sYXRpb25UaWNrZXIsXHJcblxyXG4gICAgc2hvdWxkRW5hYmxlSEEoKSB7XHJcbiAgICAgIGlmKF8uaXNDbGllbnQoKSkge1xyXG4gICAgICAgIGxldCB1c2VyQWdlbnQgPSBuYXZpZ2F0b3IudXNlckFnZW50O1xyXG4gICAgICAgIGxldCBpc01vYmlsZSA9IC9BbmRyb2lkfHdlYk9TfGlQaG9uZXxpUGFkfGlQb2R8QmxhY2tCZXJyeXxJRU1vYmlsZXxPcGVyYSBNaW5pL2kudGVzdCh1c2VyQWdlbnQpO1xyXG4gICAgICAgIGxldCBpc0dpbmdlcmJyZWFkID0gL0FuZHJvaWQgMlxcLjNcXC5bMy03XS9pLnRlc3QodXNlckFnZW50KTtcclxuICAgICAgICByZXR1cm4gdXNlckFnZW50ICYmIGlzTW9iaWxlICYmICFpc0dpbmdlcmJyZWFkO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gIH07XHJcblxyXG4gIHJldHVybiBBbmltYXRlO1xyXG59O1xyXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=