"use strict";

var _classProps = function (child, staticProps, instanceProps) {
  if (staticProps) Object.defineProperties(child, staticProps);
  if (instanceProps) Object.defineProperties(child.prototype, instanceProps);
};

require("6to5/polyfill");
var Promise = require("bluebird");
module.exports = function (R) {
  var _ = R._;
  var raf = require("raf");

  var InterpolationTicker = (function () {
    var InterpolationTicker = function InterpolationTicker(_ref) {
      var _this = this;
      var from = _ref.from;
      var to = _ref.to;
      var duration = _ref.duration;
      var easing = _ref.easing;
      var onTick = _ref.onTick;
      var onComplete = _ref.onComplete;
      var onAbort = _ref.onAbort;
      easing = easing || "cubic-in-out";
      onTick = onTick || _.noop;
      onComplete = onComplete || _.noop;
      onAbort = onAbort || _.noop;

      _.dev(function () {
        return from.should.be.an.Object && to.should.be.an.Object && duration.should.be.a.Number && (_.isPlainObject(easing) || _.isString(easing)).should.be.ok && onTick.should.be.a.Function && onComplete.should.be.a.Function && onAbort.should.be.a.Function;
      });

      this._from = from;
      this._to = to;

      Object.keys(this._from).forEach(function (attr) {
        return _.has(_this._to, attr) ? _this._to[attr] = _this._from[attr] : void 0;
      });
      Object.keys(this._to).forEach(function (attr) {
        return _.has(_this._from, attr) ? _this._from[attr] = _this._to[attr] : void 0;
      });

      if (_.isPlainObject(easing)) {
        _.dev(function () {
          return easing.type.should.be.a.String && easing.params.should.be.an.Object;
        });
        this._easing = R.Animate.createEasing(easing.type, easing.params);
      } else {
        this._easing = R.Animate.createEasing(easing);
      }
      this._duration = duration;
      this._onTick = onTick;
      this._onComplete = onComplete;
      this._onAbort = onAbort;
      this._interpolators = _.mapValues(this._from, function (fromVal, attr) {
        return R.Animate.createInterpolator(fromVal, _this._to[attr]);
      });
      this._tick = R.scope(this._tick, this);
    };

    _classProps(InterpolationTicker, null, {
      start: {
        writable: true,
        value: function () {
          var _this2 = this;
          _.dev(function () {
            return (_this2._begin === null).should.be.ok;
          });
          this._begin = Date.now();
          this._end = this._begin + this._duration;
          this._requestAnimationFrameHandle = raf(this._tick);
        }
      },
      _tick: {
        writable: true,
        value: function () {
          var _this3 = this;
          var now = Date.now();
          if (now > this._end) {
            this._onTick(this._to, 1);
            this._onComplete();
          } else {
            (function () {
              var t = (now - _this3._begin) / (_this3._end - _this3._begin);
              _this3._onTick(_.mapValues(_this3._interpolators, function (interpolator) {
                return interpolator(_this3._easing(t));
              }, t));
              _this3._requestAnimationFrameHandle = raf(_this3._tick);
            })();
          }
        }
      },
      abort: {
        writable: true,
        value: function () {
          if (this._requestAnimationFrameHandle) {
            raf.cancel(this._requestAnimationFrameHandle);
            this._requestAnimationFrameHandle = null;
          }
        }
      }
    });

    return InterpolationTicker;
  })();

  _.extend(InterpolationTicker.prototype, /** @lends R.Animate.InterpolationTicker.prototype */{
    _from: null,
    _to: null,
    _easing: null,
    _duration: null,
    _onTick: null,
    _onComplete: null,
    _onAbort: null,
    _requestAnimationFrameHandle: null,
    _begin: null,
    _end: null,
    _interpolators: null });

  return InterpolationTicker;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImc6L3JlYWN0LW5leHVzL3JlYWN0LXJhaWxzL3NyYy9SLkFuaW1hdGUuSW50ZXJwb2xhdGlvblRpY2tlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUEsT0FBTyxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBQ3pCLElBQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUNwQyxNQUFNLENBQUMsT0FBTyxHQUFHLFVBQVMsQ0FBQyxFQUFFO0FBQzNCLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDZCxNQUFNLEdBQUcsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7O01BRXJCLG1CQUFtQjtRQUFuQixtQkFBbUIsR0FDWixTQURQLG1CQUFtQixPQUNrRDs7VUFBM0QsSUFBSSxRQUFKLElBQUk7VUFBRSxFQUFFLFFBQUYsRUFBRTtVQUFFLFFBQVEsUUFBUixRQUFRO1VBQUUsTUFBTSxRQUFOLE1BQU07VUFBRSxNQUFNLFFBQU4sTUFBTTtVQUFFLFVBQVUsUUFBVixVQUFVO1VBQUUsT0FBTyxRQUFQLE9BQU87QUFDbkUsWUFBTSxHQUFHLE1BQU0sSUFBSSxjQUFjLENBQUM7QUFDbEMsWUFBTSxHQUFHLE1BQU0sSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDO0FBQzFCLGdCQUFVLEdBQUcsVUFBVSxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUM7QUFDbEMsYUFBTyxHQUFHLE9BQU8sSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDOztBQUU1QixPQUFDLENBQUMsR0FBRyxDQUFDO2VBQ0osSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLE1BQU0sSUFDeEIsRUFBRSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLE1BQU0sSUFDdEIsUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sSUFDM0IsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFD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RUFBRSxJQUFJO0FBQ2YsV0FBTyxFQUFFLElBQUk7QUFDYixlQUFXLEVBQUUsSUFBSTtBQUNqQixZQUFRLEVBQUUsSUFBSTtBQUNkLGdDQUE0QixFQUFFLElBQUk7QUFDbEMsVUFBTSxFQUFFLElBQUk7QUFDWixRQUFJLEVBQUUsSUFBSTtBQUNWLGtCQUFjLEVBQUUsSUFBSSxFQUNyQixDQUFDLENBQUM7O0FBRUgsU0FBTyxtQkFBbUIsQ0FBQztDQUM1QixDQUFDIiwiZmlsZSI6IlIuQW5pbWF0ZS5JbnRlcnBvbGF0aW9uVGlja2VyLmpzIiwic291cmNlc0NvbnRlbnQiOlsicmVxdWlyZSgnNnRvNS9wb2x5ZmlsbCcpO1xuY29uc3QgUHJvbWlzZSA9IHJlcXVpcmUoJ2JsdWViaXJkJyk7XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKFIpIHtcbiAgY29uc3QgXyA9IFIuXztcbiAgY29uc3QgcmFmID0gcmVxdWlyZSgncmFmJyk7XG5cbiAgY2xhc3MgSW50ZXJwb2xhdGlvblRpY2tlciB7XG4gICAgY29uc3RydWN0b3IoeyBmcm9tLCB0bywgZHVyYXRpb24sIGVhc2luZywgb25UaWNrLCBvbkNvbXBsZXRlLCBvbkFib3J0IH0pIHtcbiAgICAgIGVhc2luZyA9IGVhc2luZyB8fCAnY3ViaWMtaW4tb3V0JztcbiAgICAgIG9uVGljayA9IG9uVGljayB8fCBfLm5vb3A7XG4gICAgICBvbkNvbXBsZXRlID0gb25Db21wbGV0ZSB8fCBfLm5vb3A7XG4gICAgICBvbkFib3J0ID0gb25BYm9ydCB8fCBfLm5vb3A7XG5cbiAgICAgIF8uZGV2KCgpID0+XG4gICAgICAgIGZyb20uc2hvdWxkLmJlLmFuLk9iamVjdCAmJlxuICAgICAgICB0by5zaG91bGQuYmUuYW4uT2JqZWN0ICYmXG4gICAgICAgIGR1cmF0aW9uLnNob3VsZC5iZS5hLk51bWJlciAmJlxuICAgICAgICAoXy5pc1BsYWluT2JqZWN0KGVhc2luZykgfHwgXy5pc1N0cmluZyhlYXNpbmcpKS5zaG91bGQuYmUub2sgJiZcbiAgICAgICAgb25UaWNrLnNob3VsZC5iZS5hLkZ1bmN0aW9uICYmXG4gICAgICAgIG9uQ29tcGxldGUuc2hvdWxkLmJlLmEuRnVuY3Rpb24gJiZcbiAgICAgICAgb25BYm9ydC5zaG91bGQuYmUuYS5GdW5jdGlvblxuICAgICAgKTtcblxuICAgICAgdGhpcy5fZnJvbSA9IGZyb207XG4gICAgICB0aGlzLl90byA9IHRvO1xuXG4gICAgICBPYmplY3Qua2V5cyh0aGlzLl9mcm9tKVxuICAgICAgLmZvckVhY2goKGF0dHIpID0+IF8uaGFzKHRoaXMuX3RvLCBhdHRyKSA/IHRoaXMuX3RvW2F0dHJdID0gdGhpcy5fZnJvbVthdHRyXSA6IHZvaWQgMCk7XG4gICAgICBPYmplY3Qua2V5cyh0aGlzLl90bylcbiAgICAgIC5mb3JFYWNoKChhdHRyKSA9PiBfLmhhcyh0aGlzLl9mcm9tLCBhdHRyKSA/IHRoaXMuX2Zyb21bYXR0cl0gPSB0aGlzLl90b1thdHRyXSA6IHZvaWQgMCk7XG5cbiAgICAgIGlmKF8uaXNQbGFpbk9iamVjdChlYXNpbmcpKSB7XG4gICAgICAgIF8uZGV2KCgpID0+IGVhc2luZy50eXBlLnNob3VsZC5iZS5hLlN0cmluZyAmJlxuICAgICAgICAgIGVhc2luZy5wYXJhbXMuc2hvdWxkLmJlLmFuLk9iamVjdFxuICAgICAgICApO1xuICAgICAgICB0aGlzLl9lYXNpbmcgPSBSLkFuaW1hdGUuY3JlYXRlRWFzaW5nKGVhc2luZy50eXBlLCBlYXNpbmcucGFyYW1zKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLl9lYXNpbmcgPSBSLkFuaW1hdGUuY3JlYXRlRWFzaW5nKGVhc2luZyk7XG4gICAgICB9XG4gICAgICB0aGlzLl9kdXJhdGlvbiA9IGR1cmF0aW9uO1xuICAgICAgdGhpcy5fb25UaWNrID0gb25UaWNrO1xuICAgICAgdGhpcy5fb25Db21wbGV0ZSA9IG9uQ29tcGxldGU7XG4gICAgICB0aGlzLl9vbkFib3J0ID0gb25BYm9ydDtcbiAgICAgIHRoaXMuX2ludGVycG9sYXRvcnMgPSBfLm1hcFZhbHVlcyh0aGlzLl9mcm9tLCAoZnJvbVZhbCwgYXR0cikgPT4gUi5BbmltYXRlLmNyZWF0ZUludGVycG9sYXRvcihmcm9tVmFsLCB0aGlzLl90b1thdHRyXSkpO1xuICAgICAgdGhpcy5fdGljayA9IFIuc2NvcGUodGhpcy5fdGljaywgdGhpcyk7XG4gICAgfVxuXG4gICAgc3RhcnQoKSB7XG4gICAgICBfLmRldigoKSA9PiAodGhpcy5fYmVnaW4gPT09IG51bGwpLnNob3VsZC5iZS5vayk7XG4gICAgICB0aGlzLl9iZWdpbiA9IERhdGUubm93KCk7XG4gICAgICB0aGlzLl9lbmQgPSB0aGlzLl9iZWdpbiArIHRoaXMuX2R1cmF0aW9uO1xuICAgICAgdGhpcy5fcmVxdWVzdEFuaW1hdGlvbkZyYW1lSGFuZGxlID0gcmFmKHRoaXMuX3RpY2spO1xuICAgIH1cblxuICAgIF90aWNrKCkge1xuICAgICAgbGV0IG5vdyA9IERhdGUubm93KCk7XG4gICAgICBpZihub3cgPiB0aGlzLl9lbmQpIHtcbiAgICAgICAgdGhpcy5fb25UaWNrKHRoaXMuX3RvLCAxKTtcbiAgICAgICAgdGhpcy5fb25Db21wbGV0ZSgpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGxldCB0ID0gKG5vdyAtIHRoaXMuX2JlZ2luKS8odGhpcy5fZW5kIC0gdGhpcy5fYmVnaW4pO1xuICAgICAgICB0aGlzLl9vblRpY2soXy5tYXBWYWx1ZXModGhpcy5faW50ZXJwb2xhdG9ycywgKGludGVycG9sYXRvcikgPT4gaW50ZXJwb2xhdG9yKHRoaXMuX2Vhc2luZyh0KSksIHQpKTtcbiAgICAgICAgdGhpcy5fcmVxdWVzdEFuaW1hdGlvbkZyYW1lSGFuZGxlID0gcmFmKHRoaXMuX3RpY2spO1xuICAgICAgfVxuICAgIH1cblxuICAgIGFib3J0KCkge1xuICAgICAgaWYodGhpcy5fcmVxdWVzdEFuaW1hdGlvbkZyYW1lSGFuZGxlKSB7XG4gICAgICAgIHJhZi5jYW5jZWwodGhpcy5fcmVxdWVzdEFuaW1hdGlvbkZyYW1lSGFuZGxlKTtcbiAgICAgICAgdGhpcy5fcmVxdWVzdEFuaW1hdGlvbkZyYW1lSGFuZGxlID0gbnVsbDtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBfLmV4dGVuZChJbnRlcnBvbGF0aW9uVGlja2VyLnByb3RvdHlwZSwgLyoqIEBsZW5kcyBSLkFuaW1hdGUuSW50ZXJwb2xhdGlvblRpY2tlci5wcm90b3R5cGUgKi8ge1xuICAgIF9mcm9tOiBudWxsLFxuICAgIF90bzogbnVsbCxcbiAgICBfZWFzaW5nOiBudWxsLFxuICAgIF9kdXJhdGlvbjogbnVsbCxcbiAgICBfb25UaWNrOiBudWxsLFxuICAgIF9vbkNvbXBsZXRlOiBudWxsLFxuICAgIF9vbkFib3J0OiBudWxsLFxuICAgIF9yZXF1ZXN0QW5pbWF0aW9uRnJhbWVIYW5kbGU6IG51bGwsXG4gICAgX2JlZ2luOiBudWxsLFxuICAgIF9lbmQ6IG51bGwsXG4gICAgX2ludGVycG9sYXRvcnM6IG51bGwsXG4gIH0pO1xuXG4gIHJldHVybiBJbnRlcnBvbGF0aW9uVGlja2VyO1xufTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==